<template id="template-main">
    <style>
    </style>
    <div>
        <button id="show-dialog" type="button" class="mdl-button">Show Dialog</button>
        <dialog class="mdl-dialog">
            <h4 class="mdl-dialog__title">Allow data collection?</h4>
            <div class="mdl-dialog__content">
                <p>
                    Allowing us to collect data will let us get you the information you want faster.
                </p>
            </div>
            <div class="mdl-dialog__actions">
                <button id="add_blogger" type="button" class="mdl-button">Add</button>
                <button type="button" class="mdl-button close">Cancel</button>
            </div>
        </dialog>
    </div>
</template>

<script>
  (function (global) {
    var currentDocument = document.currentScript.ownerDocument;

    function getTemplate(selector) {
      return currentDocument.querySelector(selector).content.cloneNode(true);
    }

    var valueDefinition = {
      get: function () {
        return '';
      },
      set: function (v) {
      }
    };

    var addDefinition = {
      value: function (e) {
        var evt;
        if (value) {
          evt = new CustomEvent('add-item', {detail: {label: value}});
          this.dispatchEvent(evt);
          this.value = '';
        }
      }
    };

    var onCreatedDefinition = {
      value: function () {
        var self = this;
        
        var shadowRoot = this.createShadowRoot();
        shadowRoot.appendChild(getTemplate('#template-main'));

        var dialog = shadowRoot.querySelector('dialog');
        var showDialog = shadowRoot.querySelector('#show-dialog');
        var submit = shadowRoot.querySelector('#add_blogger');
        var close =  dialog.querySelector('.close');
        if (! dialog.showModal) {
            dialogPolyfill.registerDialog(dialog);
        }
        
        this.dialog = dialog;
        this.showDialog = showDialog;

        showDialog.addEventListener('click', function (e) {
            self.dialog.showModal();
        });
        close.addEventListener('click', function() {
            self.dialog.close();
        });

        submit.addEventListener('click', function (e) {
          self.add(e);
        });
        
      }
    };

    var proto = Object.create(HTMLElement.prototype, {
      value: valueDefinition,
      add: addDefinition,
      createdCallback: onCreatedDefinition
    });

    var HTMLAddBoxElement = document.registerElement('add-blogger', {prototype: proto});

    global.HTMLAddBoxElement = HTMLAddBoxElement;
  })(this);
</script>